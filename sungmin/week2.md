# 3장 클래스 설계: 모든 것과 연결디는 설계 기반

## 3.1 클래스 단위로 잘 동작하도록 설계하기

- 클래스는 클래스 하나로도 잘 동작 할 수 있게 설계해야한다.
- 복잡한 초기 설ㅓㅇ은 하지 않고 바로 사용할 수 있도록 만들어야 한다.
- 클래스를 마음대로 조작해서 클래스 전체가 고장나는 일이 없게 최소한의 동작 장법만 외부에 제공해야한다.

### 3.1.1 클래스의 구성 요소

- 클래스는 `인스턴스 변수`와 `메서드`로 구성된다.
- 잘 만들어진 클래스는 `인스턴스 변수`와 `인스턴스 변수를 잘못된 값이 할당되지 않게 막고 정상적으로 조작하는 메서드`로 구성된다.

### 3.1.2 모든 클래스가 갖추어야 하는 자기 방어 임무

- 소프트웨어에서 메서드, 클래스, 모듈 등의 기본적인 단위들은 그 자체로 버그 없이, 언제나 안전하게 사용 할 수 있는 품질을 갖추어야 한다.
- 다른 클래스를 사용해서 초기화와 유효성 검사를 해야하는 클래스는 안전하게 사용할 수 없는 미성숙한 클래스이다.
- 클래스는 스스로 자기 방어 임무를 수행할 수 있어야 소프트웨어의 품질을 높이는데 도움이 되며, 소프트웨어의 구성 부품이라 할 수 있는 클래스 하나하나의 품질이 뛰어나야 소프트웨어의 품질이 향상된다.

## 3.2 성숙한 클래스로 성작시키는 설계 기법

### 3.2.1 생성자로 확실하게 정상적인 값 설정하기

- 데이터 클래스는 디폴트 생성자를 사용하여 인스턴스를 생성한 뒤, 인스턴스 변수에 따로 값을 할당해서 초기화한다.
  - 이는 로우 데이터 객체로서 초기화되지 않는 상태를 유발하는 클래스 구조이다.
  - 로우 데이터 객체를 방지하기 위해서는 클래스 인스턴스를 생성하는 시점에 확실하게 인스턴스 변수가 정상적인 값을 갖도록 개발을 해야한다.
- 인스턴스 변수를 초기화 할 때는 잘못된 값이 전달되는 경우를 방지하기 위해 유효성 검스를 생성자 내부에서 정의하여 처리해야한다. -> 이런 코드를 가드(guard)라고 부른다.

    ``` java
    // 생성자에서 값을 초기화 하기
    class Mondy {
        int amount;
        Currency currency;

        Money(int amount, Currency currency) {
            if (amount < 0) {
                throw new IllegalArgumentException("amount 값은 정수만 사용 가능합니다.");
            }

            if (currency == null) {
                throw new IllegalArgumentException("currency값은 null일 수 없습니다.");
            }
            this.amount = amount;
            this.currency = currency;
        })
    }
    ```

### 3.2.2 계산 로직도 데이터를 가진 쪽에 구현하기

- 데이터와 데이터를 조작하는 로직이 분리되어 있는 구조를 `응집도가 늦은 구조`라고 한다.
- 응집도가 낮은 구조에서는 여러 문제가 발생하며, 문제를 막으려면 다른 클래스에 맡겼던 일을 스스로 할 수 있게 만들어서 클래스를 더 성숙하게 만들어야 한다.

### 3.2.3 불변 변수로 만들어서 예상하지 못한 동작 막기

- 인스턴스 변수를 변경하는 코드는 이해하기 어렵다.
  - 변수의 값이 계속해서 바뀌면, 값이 언제 변경되었는지, 현재 어떤 값을 사용하고 있는지 계속 신경 써야한다.
- 비즈니스 요구 사항이 바뀌어서 코드를 수정하다가 의도하지 않는 값을 할당 하게되면 예상치 못한 부수 효과가 쉽게 발생할 수 있다.
- 이런 문제를 막기 위해서는 인스턴스 변수를 불변으로 만들어야한다.

``` java
class Mondy {
        final int amount; // 인스턴스 변수를 불변으로 선언
        final Currency currency; // 인스턴스 변수를 불변으로 선언

        Money(int amount, Currency currency) {
            if (amount < 0) {
                throw new IllegalArgumentException("amount 값은 정수만 사용 가능합니다.");
            }

            if (currency == null) {
                throw new IllegalArgumentException("currency값은 null일 수 없습니다.");
            }
            this.amount = amount;
            this.currency = currency;
        })
    }
```

### 3.2.4 변경하고 싶다면 새로운 인스턴스 만들기

- 인스턴스 변수를 불편으로 선언해서 사용했지만, 해당 값을 변경을 해야하는 경우가 발생한다면, 새로운 인스턴스를 만들어서 사용한다.

### 3.2.5 매서드 매개변수와 지역 변수도 불변으로 만들기

- 기본적으로 메서드의 매개변수의 경우 메서드 내부에서 값을 변경할 수 있다.
- 하지만 값이 중간에 바뀌면 값의 변화를 추적하기 힘들기 때문에 매개변수는 변경하지 않는 것이 좋다.

### 3.2.6 엉뜡한 값을 전달하지 않도록 하기

- 프로그래밍 언어가 표준적으로 제공하는 자료형을 사용하게 되면 의미가 다른 값이지만 같은 자료형 타입인 값을 넣게되면, 컴파일 오류가 없이 서비스는 정상적으로 동작하지만, 버그가 있는 서비스가 된다.
- 따라서 실수를 줄이기 위해서는 아래와 같이 클래스 타입을 정의해서 사용하면 실수를 줄이기 쉽다.

``` java
class Mondy {
        /**
         * 생략 
        */
        Mondy add(final Money money) {
            final int addedMoney = amount + money.amount;
            return new Money(addedMone, currency)
        }
    }
```

### 3.2.7 의미 없는 메서드 추가하지 않기

- 실제 서비스를 개발 할 때 미래를 생각하고 메시드를 추가해서 개발하는 것이 아닌, 현재 요구사항에 맞는 메서드를 개발해야한다. -> 예상치 못한 버그를 막기 위해

## 3.4 프로그램 구조의 문제 해결에 도움을 주는 디자인 패턴

- 응집도가 높은 구조를 만들거나, 잘못된 상태로부터 프로그램을 방어하는 프로그램의 구조를 개선하는 설계 방법을 `디자인 패턴`이라고 부른다.

### 3.4.1 완전 생성자

- 완전 생성자는 잘못된 상태로부터 클래스를 보호하기 위한 디자인 패턴이다.
- 매개변수 없는 디폴트 생성자로 객체를 생성하고, 이후 인스턴스 변수에 값을 설정하는 방법은 인스턴스 변수를 초기화하지 않을 가능성이 존재한다.
- 쓰레기 객체를 방지하려면 인스턴스 변수를 모두 초기화해야만 객체를 생성할 수 있게 만들면된다.

### 3.4.2 값 객체

- 값 객체란 값을 클래스로 나타내는 디자인 패턴이다.
- 값 객체를 만들어서 사용하면 각각의 값과 로직을 응집도가 높은 구조로 만들 수 있다.
